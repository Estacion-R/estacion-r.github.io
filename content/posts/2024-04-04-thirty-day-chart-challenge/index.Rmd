---
title: Thirty Day Chart Challenge
author: Pablo Tiscornia
date: '2024-04-04'
slug: thirty-day-chart-challenge
categories:
  - rstatES
  - dataviz
  - cienciadedatos
tags:
  - dataviz
  - ggplot2
  - highcharter
  - plotly
  - rstatES
toc: no
images: ~
---



```{r echo=FALSE}
     #.......................Configuraci√≥n .Rmd.......................
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)
```

![](https://github.com/30DayChartChallenge/Edition2024/raw/main/img/prompts.png)

<br>

## D√≠a 4 - Waffle

```{r librerias}
library(ARTofR)
library(dplyr)
library(purrr) 
library(stringr)
library(janitor)
library(highcharter)
library(viridisLite)
```

```{r data}
     #................Traigo datos gracias {datapasta}................
df_causa_muerte_2022 <- tibble::tribble(
    ~lugar,   ~cant,
    "Hogar", 411803,
    "Instituto Mexicano del Seguro Social (IMSS)", 145608,
    "Secretar√≠a de Salud (SSA)", 99960,
    "Unidad m√©dica privada", 36629,
    "ISSSTE", 27572,
    "V√≠a p√∫blica", 35392,
    "Otro lugar", 43740,
    "Otra unidad p√∫blica", 22549,
    "No espec√≠ficado", 18065
)


     #..........................Preparo datos.........................
df_causa_muerte_2022 <- df_causa_muerte_2022 |> 
  mutate(
    lugar = case_when(lugar %in% c("Instituto Mexicano del Seguro Social (IMSS)", "Secretar√≠a de Salud (SSA)",
                                   "ISSSTE", "Otra unidad p√∫blica") ~ "Unidad m√©dica p√∫blica",
                      .default = lugar)) |> 
  summarise(cant = sum(cant),
            .by = "lugar") |> 
  mutate(porc = round(cant / sum(cant) * 100, 1),
         faico = case_when(lugar == "Hogar" ~ "house",
                           lugar == "Unidad m√©dica p√∫blica" ~ "circle-h",
                           lugar == "Unidad m√©dica privada" ~ "hospital",
                           lugar == "V√≠a p√∫blica" ~ "street-view",
                           lugar == "Otro lugar" ~ "map",
                           lugar == "No espec√≠ficado" ~ "question"),
         #col = substr(viridis(6), 0, 7)
         col = c("#66c2a5", "#fc8d62", "#8da0cb", "#e78ac3", "#a6d854", "#ffd92f"))



     #.................funci√≥n para renderizar √≠conos.................
fa_to_png_to_datauri <- function(name, ...) {

  tmpfl <- tempfile(fileext = ".png")

  fontawesome::fa_png(name, file = tmpfl, ...)

  knitr::image_uri(tmpfl)

}


      #.........................Preparo √≠conos.........................
df_viz <- df_causa_muerte_2022 |>
  mutate(
    uri = map2_chr(faico, col, ~fa_to_png_to_datauri(.x, fill = .y)),
    marker = map(uri, ~ list(symbol = str_glue("url({data_uri})", data_uri = .x)))
  )
```

```{r viz}

     #..............................VIZ...............................
hchart(
  df_viz,
  "item",
  hcaes(name = lugar, y = porc),
  name = "What I eat",
  showInLegend = TRUE
  ) |>
  hc_title(
    text = "Distribuci√≥n de las defunciones seg√∫n sitio de ocurrencia",
    useHTML = TRUE
  ) |> 
  hc_subtitle(
    text = "M√©xico üá≤üáΩ. A√±o 2022"
  ) |> 
  hc_caption(
    text = "Fuente: INEGI. Estad√≠sticas de Defunciones Registradas (EDR), 2022") |> 
  hc_plotOptions(
    # avoid hide series due bug
    series = list(point = list(events = list(legendItemClick = JS("function(e) {e.preventDefault() }"))))
  ) |>
  hc_legend(
    labelFormat =  '{name} <span style="opacity: 0.4">{y}%</span>'
  ) |>
  hc_colors(pull(df_viz, col))
```

<br>

### Recursos utilizados:

- Referencia para crear el gr√°fico con `{highcharter}`: [LINK](https://jkunst.com/highcharter/articles/fontawesome.html?q=waffle#another-example) 
    
    - Autor: [Joshua Kunst](https://jkunst.com/)

- Paleta de colores generada en [colorbrewer2.org](https://colorbrewer2.org/#type=qualitative&scheme=Set2&n=6)

- C√≥digo: [LINK](https://github.com/pablotis/estacion-r.github.io/tree/main/R/CODE_30DayChallenge_day-4.R)

